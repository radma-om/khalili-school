/* empty css                */(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const e of document.querySelectorAll('link[rel="modulepreload"]'))s(e);new MutationObserver(e=>{for(const o of e)if(o.type==="childList")for(const c of o.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&s(c)}).observe(document,{childList:!0,subtree:!0});function n(e){const o={};return e.integrity&&(o.integrity=e.integrity),e.referrerPolicy&&(o.referrerPolicy=e.referrerPolicy),e.crossOrigin==="use-credentials"?o.credentials="include":e.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function s(e){if(e.ep)return;e.ep=!0;const o=n(e);fetch(e.href,o)}})();const f=window.Cookies;let i={};document.addEventListener("DOMContentLoaded",async()=>{if(!f.get("username")){window.location.href="login.html";return}await h()});async function h(){try{const a=["./Data/Classes/الصف الأول.xlsx","./Data/Classes/الصف الثاني.xlsx","./Data/Classes/الصف الثالث.xlsx"];for(const t of a)try{const n=await fetch(t);if(n.ok){const s=await n.json(),e=t.split("/").pop().replace(".xlsx","");i[e]=s}}catch(n){console.error(`Error loading class file ${t}:`,n)}g(Object.keys(i))}catch(a){console.error("Error loading class files:",a)}}function g(a){const t=document.getElementById("classSelect");t.innerHTML='<option value="">اختر الصف</option>',a.forEach(n=>{const s=document.createElement("option");s.value=n,s.textContent=n,t.appendChild(s)})}var u;(u=document.getElementById("classSelect"))==null||u.addEventListener("change",a=>{const t=a.target.value;t&&y(i[t])});function y(a){const t=document.getElementById("studentList");t.innerHTML="",a.forEach(n=>{const s=document.createElement("div");s.className="flex items-center p-2 hover:bg-blue-50 rounded-lg transition-colors duration-200";const e=document.createElement("input");e.type="checkbox",e.className="student-checkbox ml-3",e.value=n.id;const o=document.createElement("label");o.className="flex-1 cursor-pointer",o.textContent=`${n.name} - ${n.phone}`,s.appendChild(e),s.appendChild(o),t.appendChild(s)})}var m;(m=document.getElementById("selectAll"))==null||m.addEventListener("change",a=>{document.querySelectorAll(".student-checkbox").forEach(n=>{n.checked=a.target.checked})});window.updateEventVariable=function(){document.getElementById("eventInput").value};window.insertVariable=function(a){const t=document.getElementById("messageTemplate"),n=t.value,s=t.selectionStart,e={studentName:"{{studentName}}",teacherName:"{{teacherName}}",className:"{{className}}",date:"{{date}}",event:"{{event}}",time:"{{time}}"},o=n.slice(0,s)+e[a]+n.slice(s);t.value=o,t.focus()};window.sendMessages=async function(){const a=document.getElementById("messageTemplate").value,t=document.getElementById("classSelect").value,n=document.getElementById("eventInput").value;if(!n){alert("الرجاء إدخال الحدث قبل إرسال الرسائل");return}const s=document.querySelectorAll(".student-checkbox:checked"),e=Array.from(s).map(r=>r.value);let o=0,c=0;for(const r of e){const l=i[t].find(d=>d.id===r);if(l){const d=w(a,{studentName:l.name,teacherName:f.get("teacherName"),className:t,date:new Date().toLocaleDateString("ar-SA"),time:new Date().toLocaleTimeString("ar-SA"),event:n});try{await b(l.phone,d),o++}catch(p){console.error(`Error sending message to ${l.name}:`,p),c++}}}alert(`تم إرسال ${o} رسالة بنجاح
فشل إرسال ${c} رسالة`)};function w(a,t){let n=a;for(const[s,e]of Object.entries(t))n=n.replace(new RegExp(`{{${s}}}`,"g"),e);return n}async function b(a,t){const n="AC30f8388777afe643e27075357a0d0e0d",s="9da7ffe2cb2b28d9c6239d22572b5bc6",e="HXb5b62575e6e4ff6129ad7c8efe1f983e";try{const o=await fetch(`https://api.twilio.com/2010-04-01/Accounts/${n}/Messages.json`,{method:"POST",headers:{Authorization:"Basic "+btoa(`${n}:${s}`),"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams({To:`whatsapp:+${a}`,From:"whatsapp:+14155238886",TemplateSid:e,ContentSid:e,ContentVariables:JSON.stringify({1:new Date().toLocaleDateString("ar-SA"),2:new Date().toLocaleTimeString("ar-SA",{hour:"numeric",minute:"numeric",hour12:!0})}),Body:t})});if(!o.ok){const r=await o.json();throw new Error(`Twilio API error: ${r.message||o.statusText}`)}return await o.json()}catch(o){throw console.error("Error sending WhatsApp message:",o),o}}
